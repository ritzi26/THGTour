
<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <title>THG Tour</title>
  <link rel="stylesheet" href="style.css" type="text/css">
</head>

<body>
  <div id="player"></div>
  <div class="wrapper">
    <div class="buttonDiv">
      <h1>Wechseln</h1>
    </div>
  </div>

  <script type="text/javascript" charset="utf-8" src="https://cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"> </script>
  <script type="text/javascript" charset="utf-8" src="dist/clappr-video360.min.js"></script>
  <script type="text/javascript" charset="utf-8">


    /*var source1Url = './res/THG/VID_1OG_backfront.mp4';
    var source2Url = './res/THG/VID_TrepOst_backfront.mp4';
    var source3Url = './res/THG/VID_3OG_backfront.mp4';*/

    var testUrl = 'http://thiago.me/demo-360/cool.mp4';
    var source1Url = 'http://93.90.200.83/res/THG/VID_1OG_backfront.mp4';
    var source2Url = 'http://93.90.200.83/res/THG/VID_TrepOst_backfront.mp4';
    var source3Url = 'http://93.90.200.83/res/THG/VID_3OG_backfront.mp4';
    var currentSourceUrl = source1Url;

    var dir = true;
    var forwardAllowed = true;
    var backwardAllowed = false;
    var barrier = 0.5;

    var justStarted = true;

    var videoId = 0;
    var currentLable = 0; // 0 kein Lable ist gesetzt zahl entspricht array
    /*
    [Videos
      [Stellen
        [ButtonName, SourceLink, StartTime, EndTime, NewVideoId, NewTime, Walkable, LabelSet]
      ]
    ]
    */
    let array = [
      [
        ['Chemie', 'http://93.90.200.83/res/THG/VID_TrepOst.mp4', 10, 15, 1, 0, false, false],
        ['Treppe', 'http://93.90.200.83/res/THG/VID_TrepOst.mp4', 2, 5, 2, 0, false]
      ],
      [],
      []
    ];

    console.log(array[0][0][0]);

    var p = new Clappr.Player({
      source: source3Url,
      width: window.innerWidth,
      height: window.innerHeight,
      preload: 'true',
      chromeless: true,
      mute: true,
      plugins: [Video360],
      parentId: '#player',
      events: {onPlay: function () {if (justStarted) {p.pause(); justStarted = false;}},}
    });
    p.getPlugin('click_to_pause').disable();

    p.core.activePlayback.el.playbackRate = 1;

    p.play();
    //var startTimer = setTimeout(() => {p.pause();}, 1000);

    setInterval(() => {
      if (dir && (p.getCurrentTime() >  (p.getDuration()/2)-barrier)) {
        p.pause();
        forwardAllowed = false;
      } else if (!dir && (p.getCurrentTime() > p.getDuration()-barrier)) {
        p.pause();
        backwardAllowed = false;
      } else {
        forwardAllowed = true;
        backwardAllowed = true;
      }

    }, 1);

    setInterval(() => {
      for(var i =0; i< array[videoId].length; i++ ){
        var LabelStart = array[videoId][i][2];
        var LabelEnd = array[videoId][i][3];
        var LabelSet = array[videoId][i][7];
        console.log("Start" + LabelStart);
        var control = p.getDuration() - p.getCurrentTime();
        console.log("currentTime_reverse" + control);
        console.log("currentTime" + p.getCurrentTime());
        console.log("Ende" + LabelEnd);
        if (p.getCurrentTime() > LabelStart && p.getCurrentTime() < LabelEnd ){
          currentLable = i;
          setLable(currentLable);
          array[videoId][i][7] = true;
        }else if ((p.getDuration()-p.getCurrentTime()) > LabelStart && (p.getDuration() - p.getCurrentTime()) < LabelEnd ) {
          currentLable = i;
          setLable(currentLable);
          array[videoId][i][7] = true;
        }else if (LabelSet){
          array[videoId][i][7] = false;
          hideLable();
          currentLable = 0;
        }
      }
    },100);

    setInterval(() => {p.resize({height: window.innerHeight, width: window.innerWidth});}, 1000);

    function setLable(label) {
      document.querySelector(".buttonDiv h1").innerHTML = array[videoId][label][0];
      document.querySelector(".buttonDiv").style.visibility = "visible"
    };

    function hideLable() {
      document.querySelector(".buttonDiv").style.visibility = "collapse"
    };

    document.onkeydown = function(e) {
      if ((e.code == "ArrowUp" || e.code == "ArrowRight") && forwardAllowed) {
        if (!dir) {p.seek(p.getDuration()-p.getCurrentTime());}
        dir = true;
        backwardAllowed = true;
        p.play();
      } else if ((e.code == "ArrowDown" || e.code == "ArrowLeft") && backwardAllowed) {
        if (dir) {p.seek(p.getDuration()-p.getCurrentTime());}
        dir = false;
        forwardAllowed = true;
        p.play();
      } else if (e.code == "KeyL") { //Zum Ausprobieren von setLable()
        setLable();
      } else if (e.code == "KeyH") { //Zum Ausprobieren von hideLable()
        hideLable();
      }
    };

    document.onkeyup = function(e) {
      if (e.code == "ArrowUp" || e.code == "ArrowRight") {
        p.pause();
      } else if (e.code == "ArrowDown" || e.code == "ArrowLeft") {
        p.pause();
      }
    };

    document.querySelector(".buttonDiv").addEventListener("click", (e) => {
      p.load(source2Url);
      justStarted = true;
      p.play();
      forwardAllowed = true;
    });
  </script>
</body>
</html>
